# ═══════════════════════════════════════════════════════════
#  n8n Backend — Powers all 3,600+ automation workflows
#
#  Usage:
#    docker compose up -d          # Start n8n
#    docker compose down           # Stop n8n
#    docker compose logs -f n8n    # View n8n logs
#
#  After starting, visit http://localhost:5678 to:
#    1. Create your n8n account (first time only)
#    2. Go to Settings → API → Create API Key
#    3. Copy the key to server/.env as N8N_API_KEY=<key>
#    4. Configure credentials for any services you want
#       (Gmail, Slack, Stripe, HubSpot, etc.)
# ═══════════════════════════════════════════════════════════

services:
  n8n:
    image: n8nio/n8n:latest
    container_name: crewos-n8n
    restart: unless-stopped
    ports:
      - "5678:5678"
    environment:
      # ─── Core settings ──────────────────────────────────
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-crewos-n8n-encryption-key-change-in-production}

      # ─── Execution settings ─────────────────────────────
      - EXECUTIONS_MODE=regular
      - EXECUTIONS_TIMEOUT=300
      - EXECUTIONS_TIMEOUT_MAX=600
      - EXECUTIONS_DATA_SAVE_ON_ERROR=all
      - EXECUTIONS_DATA_SAVE_ON_SUCCESS=all
      - EXECUTIONS_DATA_SAVE_ON_PROGRESS=true
      - EXECUTIONS_DATA_SAVE_MANUAL_EXECUTIONS=true

      # ─── API access (for our backend to call n8n) ──────
      - N8N_PUBLIC_API_DISABLED=false

      # ─── UI settings ───────────────────────────────────
      - N8N_EDITOR_BASE_URL=http://localhost:5678
      - N8N_PERSONALIZATION_ENABLED=false
      - N8N_DIAGNOSTICS_ENABLED=false
      - N8N_VERSION_NOTIFICATIONS_ENABLED=false

    volumes:
      - n8n_data:/home/node/.n8n

volumes:
  n8n_data:
    driver: local


